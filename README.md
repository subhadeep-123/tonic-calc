# tonic_micro

A microservice example using [Tonic](https://github.com/hyperium/tonic) for gRPC in Rust, featuring TLS, authentication, observability, and configuration via TOML and environment variables.

## Features

- gRPC server and client using Tonic
- TLS support with OpenSSL-generated certificates
- Configurable via `Config.toml` and environment variables
- Authentication via token
- Observability (tracing)
- Health checks

## Project Structure

```
├── src/
│   ├── config.rs           # Configuration loading
│   ├── lib.rs
│   ├── middleware.rs
│   ├── server/
│   │   ├── handler.rs      # gRPC service implementation
│   │   ├── health.rs       # Health check
│   │   ├── interceptor.rs  # Auth interceptor
│   │   ├── mod.rs
│   │   ├── signal.rs       # Shutdown handler
│   │   ├── state.rs        # App state
│   ├── client/
│   │   ├── grpc.rs         # gRPC client
│   │   ├── interceptor.rs  # Client interceptor
│   │   ├── mod.rs
│   ├── generated/
│   │   ├── service.rs      # Generated by tonic_build
│   │   ├── mod.rs
│   ├── middleware/
│   │   ├── logging.rs      # Logging middleware
│   ├── proto/
│   ├── bin/
│   │   ├── client.rs       # Client binary
│   │   ├── server.rs       # Server binary
├── proto/
│   └── service.proto       # gRPC service definition
├── tls/                    # TLS certificates
├── Config.toml             # Example config file
├── Makefile                # Certificate generation and build helpers
├── build.rs                # tonic_build configuration
```

## Getting Started

### 1. Generate TLS Certificates

```sh
make certs
```

Certificates will be placed in the `tls/` directory.

### 2. Configure

Edit `Config.toml` for server/client settings, or use environment variables prefixed with `APP__`.

### 3. Build

```sh
cargo build
```

### 4. Run Server

```sh
cargo run --bin server
```

### 5. Run Client

```sh
cargo run --bin client
```

## Configuration

See [`src/config.rs`](src/config.rs) for the [`Settings`](src/config.rs) struct and supported fields.

## Protobuf

Edit [`proto/service.proto`](proto/service.proto) and run:

```sh
cargo build
```

to regenerate Rust code in [`src/generated/`](src/generated/)